sudo: true
cache: npm
language: node_js
node_js: "10.15.3"
services:
  - postgresql
addons:
  postgresql: "11.3"
before_install:
  - sudo apt-get --yes remove postgresql\*
  - sudo apt-get install -y postgresql-11 postgresql-client-11
  - sudo cp /etc/postgresql/{9.6,11}/main/pg_hba.conf
  - sudo service postgresql restart 11
  - psql -c "CREATE DATABASE $DB_NAME;" -U postgres
  - psql -c 'CREATE ROLE travis SUPERUSER LOGIN CREATEDB;' -U postgres
install:
  - npm i
jobs:
  include:
    - stage: test
      script:
        - npm run lint
        - npm run knex:migrate
        - npm run test:travis
